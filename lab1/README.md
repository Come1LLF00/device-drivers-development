# Лабораторная работа 1

**Название:** "Разработка драйверов символьных устройств"

**Цель работы:** разработать драйвер символьного устройства

## Описание функциональности драйвера

В файловой системе создаются два файла:
* `/dev/var2`
* `/proc/var2`
Первый имеет функциональность, что при чтении из него выдаются в кольцевой буфер ядра ( `sudo dmesg` ) последовательно `5` последних решений. А при записе в него простых выражений вида `argoparg`, где `arg` -- это целые числа, а `op` -- это символ операции, которую нужно сотворить с этими аргументами, он заполняет этот буфер. Второй имеет право только на чтение, при попытке записи вернется ошибка.
Список поддерживаемых операций:
* `+` -- сложение
* `-` -- вычитание
* `*` -- умножение
* `/` -- деление

## Инструкция по сборке

```
make # собрать исходники
sudo make load # загрузить модуль
sudo make mkdev # создать узел устройства
# далее свободно взаимодействуем с файлами, согласно интерфейсу определенному вариантом
```
### Дополнительно

```
sudo make unload # выгрузить загруженный модуль
sudo make rmdev # удалить созданный узел устройства
```

## Инструкция пользователя

1. Собрать модуль
2. Загрузить модуль
3. Создать узел для устройства
4. Писать в узел простые выражения ( без пробелов и прочих разделителей, все слитно -- операнд операция операнд ).
5. Читать из узла для получение ранее вычисленных выражений, на одно чтение по кругу выводятся последовательно пять последних результатов
6. При чтении из файла `/proc/var2` проверять лог для того, чтобы увидеть результат чтения
7. По завершению работы выгрузить модуль и удалить созданный узел с помощью соответствующих целей в `Makefile` 

## Примеры использования

### Пример работы с `/dev/var2`
```
echo "-3+8" > /dev/var2
cat /dev/var2
sudo dmesg
-------------
[ 2675.645038] chr_comp: file /dev/var2 opened
[ 2675.645067] chr_comp: dev_var2_write: count = 3, a = -3, b = 8, c = +, length = 5
[ 2675.645075] chr_comp: file /dev/var2 closed
[ 2680.093943] chr_comp: file /dev/var2 opened
[ 2680.093963] chr_comp: dev_var2_read: 5
[ 2680.126896] chr_comp: file /dev/var2 closed
```
```
echo "1/0" > /dev/var2
cat /dev/var2
sudo dmesg
-------------
[ 2531.322739] chr_comp: file /dev/var2 opened
[ 2531.322768] chr_comp: dev_var2_write: count = 3, a = 1, b = 0, c = /, length = 4
[ 2531.332597] chr_comp: file /dev/var2 closed
[ 2638.040875] chr_comp: file /dev/var2 opened
[ 2638.040887] chr_comp: dev_var2_read: 0
[ 2638.089075] chr_comp: file /dev/var2 closed
```

### Пример работы с `/proc/var2`
```
cat /proc/var2
sudo dmesg -c
----------
[  590.119804] chr_comp: file /proc/var2 opened
[  590.119817] chr_comp: proc_var2_read: 5
[  590.181147] chr_comp: file /proc/var2 closed
```

## Дополнительное задание

Через параметр задавать число создаваемых устройств.
История вычислений, /proc/var2 и dmesg общий.
